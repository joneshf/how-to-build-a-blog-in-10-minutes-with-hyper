// Generated by purs version 0.11.4
"use strict";
var Blog_Comment = require("../Blog.Comment");
var Blog_Post = require("../Blog.Post");
var Blog_Types_Body = require("../Blog.Types.Body");
var Blog_Types_PostId = require("../Blog.Types.PostId");
var Control_Bind = require("../Control.Bind");
var Control_IxMonad = require("../Control.IxMonad");
var Control_Monad_Aff = require("../Control.Monad.Aff");
var Control_Monad_Aff_AVar = require("../Control.Monad.Aff.AVar");
var Control_Monad_Aff_Class = require("../Control.Monad.Aff.Class");
var Control_Monad_Eff = require("../Control.Monad.Eff");
var Control_Monad_Eff_Class = require("../Control.Monad.Eff.Class");
var Control_Monad_Eff_Console = require("../Control.Monad.Eff.Console");
var Control_Monad_Eff_Exception = require("../Control.Monad.Eff.Exception");
var Control_Monad_Error_Class = require("../Control.Monad.Error.Class");
var Control_Monad_Except_Trans = require("../Control.Monad.Except.Trans");
var Data_Either = require("../Data.Either");
var Data_Foldable = require("../Data.Foldable");
var Data_Function = require("../Data.Function");
var Data_Functor = require("../Data.Functor");
var Data_Maybe = require("../Data.Maybe");
var Data_MediaType_Common = require("../Data.MediaType.Common");
var Data_Monoid = require("../Data.Monoid");
var Data_Symbol = require("../Data.Symbol");
var Data_Unit = require("../Data.Unit");
var Database_PostgreSQL = require("../Database.PostgreSQL");
var Hyper_Conn = require("../Hyper.Conn");
var Hyper_Form = require("../Hyper.Form");
var Hyper_Middleware = require("../Hyper.Middleware");
var Hyper_Node_Server = require("../Hyper.Node.Server");
var Hyper_Response = require("../Hyper.Response");
var Hyper_Status = require("../Hyper.Status");
var Hyper_Trout_Router = require("../Hyper.Trout.Router");
var Node_HTTP = require("../Node.HTTP");
var Post_Title = require("../Post.Title");
var Scaffold = require("../Scaffold");
var Scaffold_Form = require("../Scaffold.Form");
var Scaffold_Id = require("../Scaffold.Id");
var Scaffold_Server = require("../Scaffold.Server");
var Type_Proxy = require("../Type.Proxy");
var Type_Trout = require("../Type.Trout");
var Type_Trout_ContentType_HTML = require("../Type.Trout.ContentType.HTML");
var poolConfiguration = {
    database: "blog", 
    host: "localhost", 
    idleTimeoutMillis: 600000, 
    max: 100, 
    password: "", 
    port: 5432, 
    user: "blog"
};
var blog = Type_Proxy["Proxy"].value;
var main = (function () {
    var onRoutingError = function (status) {
        return function (msg) {
            return Control_IxMonad.iapplySecond(Hyper_Middleware.ixMonadMiddleware(Control_Monad_Aff.monadAff))(Control_IxMonad.iapplySecond(Hyper_Middleware.ixMonadMiddleware(Control_Monad_Aff.monadAff))(Control_IxMonad.iapplySecond(Hyper_Middleware.ixMonadMiddleware(Control_Monad_Aff.monadAff))(Hyper_Response.writeStatus(Hyper_Node_Server.responseWriterHttpResponse(Control_Monad_Aff_Class.monadAffAff))(status))(Hyper_Response.contentType(Control_Monad_Aff.monadAff)(Hyper_Node_Server.responseWriterHttpResponse(Control_Monad_Aff_Class.monadAffAff))(Data_MediaType_Common.textHTML)))(Hyper_Response.closeHeaders(Hyper_Node_Server.responseWriterHttpResponse(Control_Monad_Aff_Class.monadAffAff))))(Hyper_Response.respond(Control_Monad_Aff.monadAff)(Hyper_Node_Server.stringNodeResponse(Control_Monad_Aff_Class.monadAffAff))(Hyper_Node_Server.responseWriterHttpResponse(Control_Monad_Aff_Class.monadAffAff))(Data_Foldable.fold(Data_Foldable.foldableMaybe)(Data_Monoid.monoidString)(msg)));
        };
    };
    var handlers = function (dictMonadAff) {
        return function (dictMonadThrow) {
            return function (conn) {
                return function (form) {
                    return new Type_Trout.AltE(Scaffold_Server.server(Blog_Post.columnsPost)(Blog_Comment.foreignKeyCommentId)(Blog_Post.fromSQLRowPost)(Blog_Comment.fromSQLRowComment)(dictMonadAff)(dictMonadThrow)(Blog_Post.tablePost)(Blog_Comment.tableComment)(Database_PostgreSQL.toSQLRowTuple(Post_Title.toSQLValueTitle)(Database_PostgreSQL.toSQLRowTuple(Blog_Types_Body.toSQLValueBody)(Database_PostgreSQL.toSQLRowUnit)))(conn)(Control_Bind.bind(Data_Either.bindEither)(form)(Scaffold_Form.fromForm(Scaffold_Form.fromFormTuple(Post_Title.fromFormTitle)(Scaffold_Form.fromFormTuple(Blog_Types_Body.fromFormBody)(Scaffold_Form.fromFormUnit))))), Scaffold_Server.createElement(Blog_Comment.columnsComment)(Blog_Comment.foreignKeyCommentId)(Blog_Post.fromSQLRowPost)(Blog_Comment.fromSQLRowComment)(dictMonadAff)(dictMonadThrow)(Blog_Post.tablePost)(Blog_Comment.tableComment)(Database_PostgreSQL.toSQLRowTuple(Blog_Types_Body.toSQLValueBody)(Database_PostgreSQL.toSQLRowTuple(Blog_Types_PostId.toSQLValuePostId)(Database_PostgreSQL.toSQLRowUnit)))(conn)(Control_Bind.bind(Data_Either.bindEither)(form)(Scaffold_Form.fromForm(Scaffold_Form.fromFormTuple(Blog_Types_Body.fromFormBody)(Scaffold_Form.fromFormTuple(Blog_Types_PostId.fromFormPostId)(Scaffold_Form.fromFormUnit))))));
                };
            };
        };
    };
    var server$prime = function (conn) {
        return function (form) {
            return Hyper_Trout_Router.router(Control_Monad_Aff.monadAff)(Hyper_Node_Server.requestHttpRequest(Control_Monad_Aff.monadAff))(Hyper_Trout_Router.routerAltE(Hyper_Trout_Router.routerAltE(Hyper_Trout_Router.routerAltE(Hyper_Trout_Router.routerAltE(Hyper_Trout_Router.routerLit(Hyper_Trout_Router.routerResource(new Data_Symbol.IsSymbol(function () {
                return "GET";
            }))(Hyper_Trout_Router.methodRouterMethod(Control_Monad_Aff.monadAff)(Hyper_Node_Server.requestHttpRequest(Control_Monad_Aff.monadAff))(Hyper_Node_Server.responseWriterHttpResponse(Control_Monad_Aff_Class.monadAffAff))(Hyper_Node_Server.stringNodeResponse(Control_Monad_Aff_Class.monadAffAff))(new Data_Symbol.IsSymbol(function () {
                return "GET";
            }))(Type_Trout_ContentType_HTML.allMimeRenderHTML(Scaffold.encodeHTMLIndex(Blog_Post.encodeHeaderPost)(Blog_Post.encodeFieldPost)(Blog_Post.genericPost)(Blog_Post.getIdPost)(new Data_Symbol.IsSymbol(function () {
                return "post";
            }))))))(new Data_Symbol.IsSymbol(function () {
                return "post";
            })))(Hyper_Trout_Router.routerLit(Hyper_Trout_Router.routerCapture(Hyper_Trout_Router.routerAltE(Hyper_Trout_Router.routerAltE(Hyper_Trout_Router.routerAltE(Hyper_Trout_Router.routerResource(new Data_Symbol.IsSymbol(function () {
                return "GET";
            }))(Hyper_Trout_Router.methodRouterMethod(Control_Monad_Aff.monadAff)(Hyper_Node_Server.requestHttpRequest(Control_Monad_Aff.monadAff))(Hyper_Node_Server.responseWriterHttpResponse(Control_Monad_Aff_Class.monadAffAff))(Hyper_Node_Server.stringNodeResponse(Control_Monad_Aff_Class.monadAffAff))(new Data_Symbol.IsSymbol(function () {
                return "GET";
            }))(Type_Trout_ContentType_HTML.allMimeRenderHTML(Scaffold.encodeHTMLCollectionShow(Blog_Comment.encodeHTMLComment)(Blog_Comment.encodeNewComment)(Blog_Post.encodeShowPost)(Blog_Comment.encodeShowComment)(Blog_Comment.foreignKeyCommentId)(Blog_Comment.genericComment)(Blog_Post.getIdPost)(new Data_Symbol.IsSymbol(function () {
                return "post";
            }))(Scaffold_Id.showId)))))(Hyper_Trout_Router.routerLit(Hyper_Trout_Router.routerResource(new Data_Symbol.IsSymbol(function () {
                return "GET";
            }))(Hyper_Trout_Router.methodRouterMethod(Control_Monad_Aff.monadAff)(Hyper_Node_Server.requestHttpRequest(Control_Monad_Aff.monadAff))(Hyper_Node_Server.responseWriterHttpResponse(Control_Monad_Aff_Class.monadAffAff))(Hyper_Node_Server.stringNodeResponse(Control_Monad_Aff_Class.monadAffAff))(new Data_Symbol.IsSymbol(function () {
                return "GET";
            }))(Type_Trout_ContentType_HTML.allMimeRenderHTML(Scaffold.encodeHTMLEdit(Blog_Post.encodeEditPost)(Blog_Post.genericPost)(Blog_Post.getIdPost)(new Data_Symbol.IsSymbol(function () {
                return "post";
            }))))))(new Data_Symbol.IsSymbol(function () {
                return "edit";
            }))))(Hyper_Trout_Router.routerLit(Hyper_Trout_Router.routerResource(new Data_Symbol.IsSymbol(function () {
                return "POST";
            }))(Hyper_Trout_Router.methodRouterMethod(Control_Monad_Aff.monadAff)(Hyper_Node_Server.requestHttpRequest(Control_Monad_Aff.monadAff))(Hyper_Node_Server.responseWriterHttpResponse(Control_Monad_Aff_Class.monadAffAff))(Hyper_Node_Server.stringNodeResponse(Control_Monad_Aff_Class.monadAffAff))(new Data_Symbol.IsSymbol(function () {
                return "POST";
            }))(Type_Trout_ContentType_HTML.allMimeRenderHTML(Blog_Post.encodeHTMLPost))))(new Data_Symbol.IsSymbol(function () {
                return "update";
            }))))(Hyper_Trout_Router.routerLit(Hyper_Trout_Router.routerResource(new Data_Symbol.IsSymbol(function () {
                return "GET";
            }))(Hyper_Trout_Router.methodRouterMethod(Control_Monad_Aff.monadAff)(Hyper_Node_Server.requestHttpRequest(Control_Monad_Aff.monadAff))(Hyper_Node_Server.responseWriterHttpResponse(Control_Monad_Aff_Class.monadAffAff))(Hyper_Node_Server.stringNodeResponse(Control_Monad_Aff_Class.monadAffAff))(new Data_Symbol.IsSymbol(function () {
                return "GET";
            }))(Type_Trout_ContentType_HTML.allMimeRenderHTML(Scaffold.encodeHTMLDestroy(Blog_Post.encodeDestroyPost)(Blog_Post.genericPost)(Blog_Post.getIdPost)(new Data_Symbol.IsSymbol(function () {
                return "post";
            }))))))(new Data_Symbol.IsSymbol(function () {
                return "destroy";
            }))))(Scaffold_Id.fromPathPieceId))(new Data_Symbol.IsSymbol(function () {
                return "post";
            }))))(Hyper_Trout_Router.routerLit(Hyper_Trout_Router.routerLit(Hyper_Trout_Router.routerResource(new Data_Symbol.IsSymbol(function () {
                return "GET";
            }))(Hyper_Trout_Router.methodRouterMethod(Control_Monad_Aff.monadAff)(Hyper_Node_Server.requestHttpRequest(Control_Monad_Aff.monadAff))(Hyper_Node_Server.responseWriterHttpResponse(Control_Monad_Aff_Class.monadAffAff))(Hyper_Node_Server.stringNodeResponse(Control_Monad_Aff_Class.monadAffAff))(new Data_Symbol.IsSymbol(function () {
                return "GET";
            }))(Type_Trout_ContentType_HTML.allMimeRenderHTML(Scaffold.encodeHTMLNew(Blog_Post.encodeNewPost)(Blog_Post.genericPost)(new Data_Symbol.IsSymbol(function () {
                return "post";
            }))))))(new Data_Symbol.IsSymbol(function () {
                return "new";
            })))(new Data_Symbol.IsSymbol(function () {
                return "post";
            }))))(Hyper_Trout_Router.routerLit(Hyper_Trout_Router.routerResource(new Data_Symbol.IsSymbol(function () {
                return "POST";
            }))(Hyper_Trout_Router.methodRouterMethod(Control_Monad_Aff.monadAff)(Hyper_Node_Server.requestHttpRequest(Control_Monad_Aff.monadAff))(Hyper_Node_Server.responseWriterHttpResponse(Control_Monad_Aff_Class.monadAffAff))(Hyper_Node_Server.stringNodeResponse(Control_Monad_Aff_Class.monadAffAff))(new Data_Symbol.IsSymbol(function () {
                return "POST";
            }))(Type_Trout_ContentType_HTML.allMimeRenderHTML(Blog_Post.encodeHTMLPost))))(new Data_Symbol.IsSymbol(function () {
                return "post";
            }))))(Hyper_Trout_Router.routerLit(Hyper_Trout_Router.routerCapture(Hyper_Trout_Router.routerResource(new Data_Symbol.IsSymbol(function () {
                return "POST";
            }))(Hyper_Trout_Router.methodRouterMethod(Control_Monad_Aff.monadAff)(Hyper_Node_Server.requestHttpRequest(Control_Monad_Aff.monadAff))(Hyper_Node_Server.responseWriterHttpResponse(Control_Monad_Aff_Class.monadAffAff))(Hyper_Node_Server.stringNodeResponse(Control_Monad_Aff_Class.monadAffAff))(new Data_Symbol.IsSymbol(function () {
                return "POST";
            }))(Type_Trout_ContentType_HTML.allMimeRenderHTML(Scaffold.encodeHTMLCollectionShow(Blog_Comment.encodeHTMLComment)(Blog_Comment.encodeNewComment)(Blog_Post.encodeShowPost)(Blog_Comment.encodeShowComment)(Blog_Comment.foreignKeyCommentId)(Blog_Comment.genericComment)(Blog_Post.getIdPost)(new Data_Symbol.IsSymbol(function () {
                return "post";
            }))(Scaffold_Id.showId)))))(Scaffold_Id.fromPathPieceId))(new Data_Symbol.IsSymbol(function () {
                return "post";
            }))))(blog)(handlers(Control_Monad_Aff_Class.monadAffExceptT(Control_Monad_Aff_Class.monadAffAff))(Control_Monad_Except_Trans.monadThrowExceptT(Control_Monad_Aff.monadAff))(conn)(form))(onRoutingError);
        };
    };
    var server = function (conn) {
        return Control_IxMonad.ibind(Hyper_Middleware.ixMonadMiddleware(Control_Monad_Aff.monadAff))(Hyper_Form.parseForm(Control_Monad_Aff.monadAff)(Hyper_Node_Server.requestHttpRequest(Control_Monad_Aff.monadAff))(Hyper_Node_Server.requestBodyReaderReqestBody(Control_Monad_Aff.monadAff)(Control_Monad_Aff_Class.monadAffAff)))(server$prime(conn));
    };
    return Data_Functor["void"](Control_Monad_Eff.functorEff)(Control_Monad_Aff.launchAff(Control_Bind.bind(Control_Monad_Aff.bindAff)(Database_PostgreSQL.newPool(poolConfiguration))(function (v) {
        return Database_PostgreSQL.withConnection(v)(function (conn) {
            return Control_Monad_Eff_Class.liftEff(Control_Monad_Aff.monadEffAff)(Hyper_Node_Server.runServer(Hyper_Node_Server.defaultOptionsWithLogging)({})(server(conn)));
        });
    })));
})();
module.exports = {
    blog: blog, 
    main: main, 
    poolConfiguration: poolConfiguration
};
