// Generated by purs version 0.11.4
"use strict";
var Control_Applicative = require("../Control.Applicative");
var Control_Bind = require("../Control.Bind");
var Control_Monad_Aff = require("../Control.Monad.Aff");
var Control_Monad_Aff_AVar = require("../Control.Monad.Aff.AVar");
var Control_Monad_Aff_Class = require("../Control.Monad.Aff.Class");
var Control_Monad_Aff_Console = require("../Control.Monad.Aff.Console");
var Data_Functor = require("../Data.Functor");
var Data_Map = require("../Data.Map");
var Data_Newtype = require("../Data.Newtype");
var Data_Semigroup = require("../Data.Semigroup");
var Data_Show = require("../Data.Show");
var Hyper_Session = require("../Hyper.Session");
var Prelude = require("../Prelude");
var InMemorySessionStore = (function () {
    function InMemorySessionStore(value0) {
        this.value0 = value0;
    };
    InMemorySessionStore.create = function (value0) {
        return new InMemorySessionStore(value0);
    };
    return InMemorySessionStore;
})();
var sessionStoreInMemorySessionStore = function (dictMonad) {
    return function (dictMonadAff) {
        return new Hyper_Session.SessionStore(function (v) {
            return function (id) {
                return Control_Monad_Aff_Class.liftAff(dictMonadAff)(Control_Bind.discard(Control_Bind.discardUnit)(Control_Monad_Aff.bindAff)(Control_Monad_Aff_Console.log("Deleting session: " + Data_Newtype.unwrap(Hyper_Session.newtypeSessionID)(id)))(function () {
                    return Control_Monad_Aff_AVar.modifyVar(Data_Map["delete"](Hyper_Session.ordSessionID)(id))(v.value0);
                }));
            };
        }, function (v) {
            return function (id) {
                return Control_Monad_Aff_Class.liftAff(dictMonadAff)(Control_Bind.discard(Control_Bind.discardUnit)(Control_Monad_Aff.bindAff)(Control_Monad_Aff_Console.log("Looking up session: " + Data_Show.show(Data_Show.showString)(Data_Newtype.unwrap(Hyper_Session.newtypeSessionID)(id))))(function () {
                    return Data_Functor.map(Control_Monad_Aff.functorAff)(Data_Map.lookup(Hyper_Session.ordSessionID)(id))(Control_Monad_Aff_AVar.peekVar(v.value0));
                }));
            };
        }, function (v) {
            return Control_Applicative.pure(dictMonad.Applicative0())("new-id");
        }, function (v) {
            return function (id) {
                return function (session) {
                    return Control_Monad_Aff_Class.liftAff(dictMonadAff)(Control_Bind.discard(Control_Bind.discardUnit)(Control_Monad_Aff.bindAff)(Control_Monad_Aff_Console.log("Saving session: " + Data_Newtype.unwrap(Hyper_Session.newtypeSessionID)(id)))(function () {
                        return Control_Monad_Aff_AVar.modifyVar(Data_Map.insert(Hyper_Session.ordSessionID)(id)(session))(v.value0);
                    }));
                };
            };
        });
    };
};
var newInMemorySessionStore = Data_Functor.map(Control_Monad_Aff.functorAff)(InMemorySessionStore.create)(Control_Monad_Aff_AVar["makeVar'"](Data_Map.empty));
module.exports = {
    InMemorySessionStore: InMemorySessionStore, 
    newInMemorySessionStore: newInMemorySessionStore, 
    sessionStoreInMemorySessionStore: sessionStoreInMemorySessionStore
};
